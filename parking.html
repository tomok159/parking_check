<!DOCTYPE html>
<html lang="ja">
<meta charset="UTF-8">
<title>駐車場自動判定</title>

<style>
body{font-family:sans-serif;text-align:center;margin-top:20px}
.grid{
 display:grid;
 grid-template-columns:120px 60px 120px;
 gap:10px;
 justify-content:center;
 margin-top:20px;
}
.spot{
 height:60px;
 border:2px solid #333;
 display:flex;
 align-items:center;
 justify-content:center;
 font-weight:bold;
 background:#7CFC90;
}
.used{background:#ff6b6b}
canvas{display:none}
</style>

<input type="file" id="file">

<div class="grid">
<div id="A1" class="spot">A1</div><div></div><div id="B1" class="spot">B1</div>
<div id="A2" class="spot">A2</div><div></div><div id="B2" class="spot">B2</div>
<div id="A3" class="spot">A3</div><div></div><div id="B3" class="spot">B3</div>
<div id="A4" class="spot">A4</div><div></div><div id="B4" class="spot">B4</div>
<div id="A5" class="spot">A5</div><div></div><div id="B5" class="spot">B5</div>
</div>

<canvas id="cv"></canvas>

<script>
file.onchange = e=>{
 const img = new Image();
 img.onload = ()=>{
  const cv = document.getElementById("cv");
  const ctx = cv.getContext("2d");
  cv.width = img.width;
  cv.height = img.height;
  ctx.drawImage(img,0,0);

  const w=img.width, h=img.height;

  const zones = {
   A1:[.15,.40,.22,.32], A2:[.15,.40,.32,.42],
   A3:[.15,.40,.42,.52], A4:[.15,.40,.52,.62],
   A5:[.15,.40,.62,.72],

   B1:[.60,.85,.22,.32], B2:[.60,.85,.32,.42],
   B3:[.60,.85,.42,.52], B4:[.60,.85,.52,.62],
   B5:[.60,.85,.62,.72],
  };

  for(let id in zones){
    const z=zones[id];
    const x=w*z[0], y=h*z[2];
    const ww=w*(z[1]-z[0]);
    const hh=h*(z[3]-z[2]);

    const data = ctx.getImageData(x,y,ww,hh).data;

    let sum=0;
    for(let i=0;i<data.length;i+=4){
      const g=(data[i]+data[i+1]+data[i+2])/3;
      sum+=g;
    }
    const mean = sum/(data.length/4);

    if(mean < 210){
      document.getElementById(id).classList.add("used");
    } else {
      document.getElementById(id).classList.remove("used");
    }
  }
 };
 img.src = URL.createObjectURL(e.target.files[0]);
};
</script>
</html>
