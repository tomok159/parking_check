<script>
file.onchange = e=>{
 const img = new Image();
 img.onload = ()=>{
  const cv = document.getElementById("cv");
  const ctx = cv.getContext("2d");
  cv.width = img.width;
  cv.height = img.height;
  ctx.drawImage(img,0,0);

  const w=img.width, h=img.height;

  const zones = {
   A1:[.15,.40,.20,.32], A2:[.15,.40,.32,.44],
   A3:[.15,.40,.44,.56], A4:[.15,.40,.56,.68],
   A5:[.15,.40,.68,.80],

   B1:[.60,.85,.20,.32], B2:[.60,.85,.32,.44],
   B3:[.60,.85,.44,.56], B4:[.60,.85,.56,.68],
   B5:[.60,.85,.68,.80],
  };

  for(let id in zones){
    const z=zones[id];
    const x=w*z[0], y=h*z[2];
    const ww=w*(z[1]-z[0]);
    const hh=h*(z[3]-z[2]);

    const data = ctx.getImageData(x,y,ww,hh).data;

    let sum=0;
    for(let i=0;i<data.length;i+=4){
      sum+=(data[i]+data[i+1]+data[i+2])/3;
    }
    const mean = sum/(data.length/4);

    console.log(id, mean);

    if(mean < 230){
      document.getElementById(id).classList.add("used");
    } else {
      document.getElementById(id).classList.remove("used");
    }
  }
 };
 img.src = URL.createObjectURL(e.target.files[0]);
};
</script>
